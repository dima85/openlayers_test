<!doctype html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="http://openlayers.org/en/v3.17.1/css/ol.css" type="text/css">
    <style>
      .map {
        height: 600px;
        width: 100%;
      }

      .ol-custom-overviewmap,
      .ol-custom-overviewmap.ol-uncollapsible {
        bottom: auto;
        left: auto;
        right: 0;
        top: 0;
      }

      .ol-custom-overviewmap:not(.ol-collapsed)  {
        border: 1px solid black;
      }

      .ol-custom-overviewmap .ol-overviewmap-map {
        border: none;
        width: 300px;
      }

      .ol-custom-overviewmap .ol-overviewmap-box {
        border: 2px solid red;
      }

      .ol-custom-overviewmap:not(.ol-collapsed) button{
        bottom: auto;
        left: auto;
        right: 1px;
        top: 1px;
      }

      .ol-rotate {
        top: 170px;
        right: 0;
      }

    </style>
    <script src="http://openlayers.org/en/v3.17.1/build/ol.js" type="text/javascript"></script>
    <title>OpenLayers 3 example</title>
  </head>
  <body>
    <h2>My Map</h2>
    <div id="map" class="map"></div>
    <script type="text/javascript">

      // http://gis.stackexchange.com/questions/159201/how-to-arrange-own-tiles-without-projection-in-openlayers-3

      // http://jsfiddle.net/vb53xz20/2/
      var tileSize = 512;
      var zoolLevel = 2;

      var minX = 0;
      var minY = 0;
      var maxX = 2048;
      var maxY = 2048;

      var projection = new ol.proj.Projection({
          code: 'ZOOMIFY',
          units: 'pixels',
          extent: [minX, minY, maxX, maxY]
      });

      var projectionExtent = projection.getExtent();

      var maxResolution = ol.extent.getWidth(projectionExtent) / tileSize;
      var resolutions = [];
      for (var z = 0; z <= zoolLevel; z++) {
          resolutions[z] = maxResolution / Math.pow(2, z+1);

      }
      console.log(resolutions);
      var urlTemplate = '/tile/{z}/{y}/{x}';

      var source = new ol.source.TileImage({
          tileUrlFunction: function(tileCoord, pixelRatio, projection) {
              var tileCoordGlobal = tileCoord;

              return urlTemplate
                  .replace('{z}', (tileCoord[0]).toString())
                  .replace('{x}', (tileCoord[1]).toString())
                  .replace('{y}', (((-tileCoord[2])-1)).toString())
              ;
          },
          wrapX: true,
          projection: projection,
          tileGrid: new ol.tilegrid.TileGrid({
              origin: ol.extent.getTopLeft(projectionExtent),
              resolutions: resolutions,
              tileSize: tileSize
          }),
      });

      tileLayer = new ol.layer.Tile({
          source: source,
          extent: projectionExtent
      });

      view = new ol.View ({
          projection: projection,
          center: [maxX/2, maxY/2],
          extent: projectionExtent,
          zoom: 0,
          rotation: Math.PI / 6,
          resolutions: resolutions
      });

      var overviewMapControl = new ol.control.OverviewMap({
        // see in overviewmap-custom.html to see the custom CSS used
        className: 'ol-overviewmap ol-custom-overviewmap',
        layers: [
          new ol.layer.Tile({
            source: source
          })
        ],
        collapseLabel: '\u00BB',
        label: '\u00AB',
        collapsed: false
      });

      window.map = new ol.Map({
          layers: [tileLayer],
          target: 'map',
          view: view,
          controls:
            ol.control.defaults().extend([
              overviewMapControl
            ])
            //ol.control.defaults({
            //  attributionOptions: /** @type {olx.control.AttributionOptions} */ ({
            //    collapsible: false
            //  })
            //})
          ,
      });

      var mousePositionControl = new ol.control.MousePosition({});

      map.addControl(mousePositionControl);

      // http://openlayers.org/en/v3.1.1/examples/zoomify.html
      function zoomifyOfficial(argument) {

        var imgWidth = 4096;
        var imgHeight = 4096;
        var tileSize = 512;

        var url = '/tile/';
        var crossOrigin = 'anonymous';

        var imgCenter = [imgWidth / 2, - imgHeight / 2];

        // Maps always need a projection, but Zoomify layers are not geo-referenced, and
        // are only measured in pixels.  So, we create a fake projection that the map
        // can use to properly display the layer.
        var proj = new ol.proj.Projection({
          code: 'ZOOMIFY',
          units: 'pixels',
          extent: [0, 0, imgWidth, imgHeight]
        });

        var source = new ol.source.Zoomify({
          url: url,
          size: [imgWidth, imgHeight],
          crossOrigin: crossOrigin,
          tileSize: tileSize
        });

        var map = new ol.Map({
          layers: [
            new ol.layer.Tile({
              source: source
            })
          ],
          //renderer: exampleNS.getRendererFromQueryString(),
          target: 'map',
          view: new ol.View({
            projection: proj,
            center: imgCenter,
            zoom: 0,
            // constrain the center: center cannot be set outside
            // this extent
            extent: [0, -imgHeight, imgWidth, 0]
          })
        });
      }

      // http://stackoverflow.com/questions/20222885/custom-tiles-in-local-crs-without-projection
      function zoomifyStackoverflow(argument) {
        var mapEdge = 1024;
        var tileSize = 512;
        //debugger;
        var projection = new ol.proj.Projection({
            code: 'ZOOMIFY',
            units: 'pixels',
            extent: [0, 0, mapEdge, mapEdge]
        });
        var projectionExtent = projection.getExtent();

        var maxResolution = ol.extent.getWidth(projectionExtent) / tileSize;
        var resolutions = [];
        for (var z = 2; z <= 4; z++) {
            resolutions[z] = maxResolution / Math.pow(2, z);
        }

        var map = new ol.Map({
            target: 'map',
            layers: [new ol.layer.Tile({
                source: new ol.source.TileImage({
                    tileUrlFunction: function(tileCoord, pixelRatio, projection) {
                        var z = tileCoord[0];
                        var x = tileCoord[1];
                        var y = -tileCoord[2] - 1;
                        return '/tile/' + z + '/' + x + '/' + y;
                    },
                    projection: projection,
                    tileGrid: new ol.tilegrid.TileGrid({
                        origin: ol.extent.getTopLeft(projectionExtent),
                        resolutions: resolutions,
                        tileSize: tileSize
                    }),
                }),
                extent: projectionExtent
            })],
            view: new ol.View({
                projection: projection,
                center: [mapEdge / 2, mapEdge / 2],
                zoom: 2,
                minZoom: 2,
                maxZoom: 4,
                extent: projectionExtent
            })
        });
      }

      function init_old() {
        // body...
        var map = new ol.Map({
          target: 'map',
          layers: [
            new ol.layer.Tile({
              source: new ol.source.OSM()
            })
          ],
          view: new ol.View({
            center: ol.proj.fromLonLat([37.41, 8.82]),
            zoom: 4
          })
        });
      }

    </script>
  </body>
</html>
